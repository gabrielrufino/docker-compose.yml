version: '3.9'

services:
  appsmith:
    image: appsmith/appsmith-ce:v1.8.9
    ports:
      - 8085:80
      - 443:443
      - 9001:9001
    volumes:
      - appsmith:/appsmith-stacks
    labels:
      com.centurylinklabs.watchtower.enable: 'true'
    # restart: always
  archlinux:
    image: archlinux
    tty: true
    volumes:
      - ./volumes/archlinux/:/home/shared
    # ports:
    #   - "22002:22"
    # restart: always
  debian:
    image: debian
    tty: true
    volumes:
      - ./volumes/debian/:/home/shared
    # ports:
    #   - "22003:22"
    # restart: always
  fedora:
    image: fedora:36
    tty: true
    volumes:
      - ./volumes/fedora/:/home/shared
    # ports:
    #   - "22004:22"
    # restart: always
  gitea:
    image: gitea/gitea:1.17.2
    environment:
      - USER_UID=1000
      - USER_GID=1000
    volumes:
      - gitea:/data
      - /etc/timezone:/etc/timezone:ro
      - /etc/localtime:/etc/localtime:ro
    ports:
      - 3002:3000
      - 222:22
    # restart: always
  grafana:
    image: grafana/grafana:9.1.6
    ports:
      - 3000:3000
    volumes:
      - grafana:/var/lib/grafana
    # restart: always
  kali:
    image: kalilinux/kali-rolling
    tty: true
    # ports:
    #   - "22000:22"
  loki:
    image: grafana/loki:2.6.1
    ports:
      - 3100:3100
    command: -config.file=/etc/loki/local-config.yaml
    # restart: always
  matomo:
    image: matomo:4.11.0
    ports:
      - 8086:80
    environment:
      MATOMO_DATABASE_HOST: mysql
      MATOMO_DATABASE_USERNAME: root
      MATOMO_DATABASE_PASSWORD: password
      MATOMO_DATABASE_DBNAME: matomo_db
    depends_on:
      - mysql
    # restart: always
  mautic:
    image: mautic/mautic:v4
    ports:
      - 8082:80
    environment:
      MAUTIC_DB_HOST: mysql
      MAUTIC_DB_USER: root
      MAUTIC_DB_PASSWORD: password
      MAUTIC_DB_NAME: mautic
      MAUTIC_RUN_CRON_JOBS: 'true'
    depends_on:
      - mysql
    # restart: always
  metabase:
    image: metabase/metabase:v0.44.3
    ports:
      - 3001:3000
    environment: 
      MB_DB_FILE: /metabase-data/metabase.db
    volumes:
      - metabase:/metabase-data
    # restart: always
  mongo:
    image: mongo:6.0.2
    ports:
      - 27017:27017
    environment:
      MONGO_INITDB_ROOT_USERNAME: root
      MONGO_INITDB_ROOT_PASSWORD: root
    volumes:
      - mongo:/data/db
    # restart: always
  mysql:
    image: mysql:8.0.29
    command: |
      --default-authentication-plugin=mysql_native_password
      --character-set-server=utf8mb4
      --collation-server=utf8mb4_general_ci
      --sql-mode=""
    environment:
      MYSQL_DATABASE: tests
      MYSQL_USER: gabrielrufino
      MYSQL_PASSWORD: 12345678
      MYSQL_ROOT_PASSWORD: password
    ports:
      - 3306:3306
    volumes:
      - mysql:/var/lib/mysql
    # restart: always
  nextcloud:
    image: nextcloud:24.0.6
    ports:
      - 8083:80
    volumes:
      - nextcloud:/var/www/html
    # restart: always
  nginx:
    image: nginx:1.23.1
    ports:
      - 80:80
      # - 443:433
    volumes:
      - ./config/nginx/sites-available:/etc/nginx/sites-available
      # - ./config/nginx/letsencrypt:/etc/letsencrypt
    # restart: always
  pgadmin:
    image: dpage/pgadmin4:6.16
    environment:
      PGADMIN_DEFAULT_EMAIL: root@gabrielrufino.com
      PGADMIN_DEFAULT_PASSWORD: root
    ports:
      - 16543:80
    volumes:
      - pgadmin:/var/lib/pgadmin
    # restart: always
  phpmyadmin:
    image: phpmyadmin:5.2.0
    environment:
      PMA_ARBITRARY: 1
    ports:
      - 8087:80
    # restart: always
  portainer:
    image: portainer/portainer-ce:2.15.1
    ports:
      - 8000:8000
      - 9000:9000
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ./volumes/portainer:/data
    # restart: always
  postgres:
    image: postgres:13
    # [Use the image bellow for postgres with ssl]
    # image: fantix/postgres-ssl:13.1
    environment:
      POSTGRES_USER: root
      POSTGRES_PASSWORD: root
      POSTGRES_DB: postgres
    ports:
      - 5432:5432
    volumes:
      - ./volumes/postgres/:/home/shared
      - postgres:/var/lib/postgresql/data
    # restart: always
  prometheus:
    image: prom/prometheus:v2.37.1
    ports:
      - 9090:9090
    volumes:
      - ./config/prometheus/prometheus.yml:/etc/prometheus/prometheus.yml
    # restart: always
  promtail:
    image: grafana/promtail:2.6.1
    ports:
      - 9080:9080
    volumes:
      - ./config/promtail/config.yaml:/etc/promtail/config.yaml
      - /var/log:/var/log
    command: -config.file=/etc/promtail/config.yaml
    # restart: always
  rabbitmq:
    image: rabbitmq:3.9.22-management
    environment:
      RABBITMQ_DEFAULT_USER: root
      RABBITMQ_DEFAULT_PASS: root
    ports:
      - 5672:5672
      - 15672:15672
    volumes:
      - ./volumes/rabbitmq/data/:/var/lib/rabbitmq
      - ./volumes/rabbitmq/log/:/var/log/rabbitmq
    # restart: always
  redis:
    image: redis:7.0.5
    ports:
      - 6379:6379
    # restart: always
  redisinsight:
    image: redislabs/redisinsight:1.13.0
    ports:
      - 8001:8001
    volumes:
      - redisinsight:/db
    # restart: always
  rethinkdb:
    image: rethinkdb:2.4.2
    ports:
      - 28015:28015
      - 28016:8080
    volumes:
      - rethinkdb:/data
    # restart: always
  sonarqube:
    image: sonarqube
    ports:
      - 9001:9000
    # restart: always
  sonic:
    image: valeriansaliou/sonic:v1.3.5
    ports:
      - 1491:1491
    volumes:
      - ./volumes/sonic/sonic.cfg:/etc/sonic.cfg
      - ./volumes/sonic/store/:/var/lib/sonic/store/
    # restart: always
  sqlserver:
    image: mcr.microsoft.com/mssql/server:2019-latest
    environment:
        SA_PASSWORD: password@123
        ACCEPT_EULA: Y
    ports:
      - 1433:1433
    # restart: always
  strapi:
    image: strapi/strapi:3.6.8
    volumes:
      - ./volumes/strapi:/srv/app
    ports:
      - 1337:1337
    # restart: always
  ubuntu:
    image: ubuntu:22.10
    tty: true
    volumes:
      - ./volumes/ubuntu/:/home/shared
    # ports:
    #   - "22001:22"
    # restart: always
  verdaccio:
    image: verdaccio/verdaccio:5.15
    environment:
      - VERDACCIO_PORT=4873
    ports:
      - 4873:4873
    volumes:
      - ./volumes/verdaccio/storage:/verdaccio/storage
    # restart: always
  vscode:
    image: gitpod/openvscode-server:1.71.2
    init: true
    tty: true
    ports:
      - 3003:3000
    volumes:
      - ./volumes/vscode:/home/workspace:cached
    # restart: always
  wordpress:
    image: wordpress
    ports:
      - 8081:80
    volumes:
      - wordpress:/var/www/html
    # restart: always

volumes:
  appsmith:
  gitea:
  grafana:
  metabase:
  mysql:
  mongo:
  nextcloud:
  pgadmin:
  postgres:
  redisinsight:
  rethinkdb:
  wordpress:
